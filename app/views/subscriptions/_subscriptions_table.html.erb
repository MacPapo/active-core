<table class="table">
    <tr>
        <% if actv  %>
            <th><%= User.human_attribute_name('name') %></th>
            <th><%= User.human_attribute_name('surname') %></th>
        <% else %>
            <th><%= Subscription.human_attribute_name('activity') %></th>
        <% end %>
        <th><%= Subscription.human_attribute_name('activity_plan') %></th>
        <th><%= Subscription.human_attribute_name('start_date') %></th>
        <th><%= Subscription.human_attribute_name('end_date') %></th>
        <th><%= Subscription.human_attribute_name('open') %></th>
        <th><%= Subscription.human_attribute_name('status') %></th>
        <th><%= t 'global.table.action' %></th>
    </tr>
    <% subscriptions.each do |subscription| %>
        <tr>
            <% presenter = SubscriptionPresenter.new(subscription) %>
            <% activity = subscription.activity %>
            <% plan = subscription.activity_plan %>

            <% if actv %>
                <% user = subscription.user %>

                <!-- User Name -->
                <td>
                    <%= user.name %>
                </td>

                <!-- User Surname -->
                <td>
                    <%= user.surname %>
                </td>
            <% else %>
                <!-- Activity Name -->
                <td>
                    <%= activity.name %>
                </td>
            <% end %>

            <!-- TODO i18n Plan -->
            <td>
                <%= plan.humanize_plan %>
            </td>

            <!-- Start date -->
            <td>
                <%= l subscription.start_date %>
            </td>

            <!-- End date -->
            <td>
                <%= l subscription.end_date %> (<%= t 'datetime.distance_in_words.x_days', count: subscription.days_til_renewal %>)
            </td>

            <!-- OPEN? -->
            <td>
                <%= t subscription.open? %>
            </td>

            <!-- STATUS -->
            <td>
                <%= link_to presenter.appropriate_path(user), class: "btn badge rounded-pill text-bg-#{ presenter.css_color }", data: { turbo_frame: "_top" } do %>
                    <i class="<%= presenter.link_icon %>"></i> <%= generic ? presenter.status_title : presenter.link_title  %>
                <% end %>
            </td>

            <!-- Action buttons -->
            <td>
                <%= link_to subscription_path(subscription), class: 'btn btn-primary' do %>
                    <i class="bi bi-eye-fill"></i>
                <% end %>

                <%= link_to edit_subscription_path(subscription), class: 'btn btn-warning' do %>
                    <i class="bi bi-pencil-fill"></i>
                <% end %>

                <% if current_staff.admin? %>
                    <%= button_to subscription_path(subscription),
                                  class: 'btn btn-danger',
                                  method: :delete,
                                  data: { turbo_confirm: t('global.destroy_dialog') }, form: {style: 'display:inline-block;'} do %>
                        <i class="bi bi-trash3-fill"></i>
                    <% end %>
                <% end %>
            </td>
        </tr>
    <% end %>
</table>
