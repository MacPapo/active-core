<h1>Modifica Utente: <%= @user.nickname %></h1>

<%= form_with model: @user, local: true do |form| %>
    <% if @user.errors.any? %>
        <div class="error-messages">
            <h2><%= pluralize(@user.errors.count, "errore") %> ha impedito il salvataggio:</h2>
            <ul>
                <% @user.errors.full_messages.each do |message| %>
                    <li><%= message %></li>
                <% end %>
            </ul>
        </div>
    <% end %>

    <div class="field">
        <%= form.label :member_id, "Membro:" %>
        <%= form.select :member_id,
            options_from_collection_for_select(
                [@user.member] + @available_members,
                :id,
                :full_name,
                @user.member_id
            ),
         {},
         { required: true } %>
        <small>Membro corrente: <%= @user.display_name %></small>
    </div>

    <div class="field">
        <%= form.label :nickname, "Nickname:" %>
        <%= form.text_field :nickname, required: true %>
        <small>Sar√† utilizzato per il login</small>
    </div>

    <div class="field">
        <%= form.label :role, "Ruolo:" %>
        <%= form.select :role,
            options_for_select([
                ['Collaboratore', 'collaborator'],
                ['Amministratore', 'admin']
            ], @user.role),
         {},
         { required: true } %>
    </div>

    <fieldset>
        <legend>Cambia Password (opzionale)</legend>
        <small>Lascia vuoto per mantenere la password attuale</small>

        <div class="field">
            <%= form.label :password, "Nuova Password:" %>
            <%= form.password_field :password %>
        </div>

        <div class="field">
            <%= form.label :password_confirmation, "Conferma Nuova Password:" %>
            <%= form.password_field :password_confirmation %>
        </div>
    </fieldset>

    <div class="actions">
        <%= form.submit "Aggiorna Utente" %>
        <%= link_to "Visualizza", @user %>
        <%= link_to "Annulla", users_path %>
    </div>
<% end %>
